<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TTG-CARE&WASH INSTRUCTIONS</title>

  <style>
  /* ============================== Sidebar Layout ============================== */
    .app-shell{
      display:flex;
      height: 100vh;     
      background: var(--bg);
    }
  
    aside#appSidebar{
      width: 280px;
      border-right:1px solid var(--line);
      background:#fff;
      position:sticky;
      top:0;
      height:100vh;
      display:flex;
      flex-direction:column;
      padding:14px;
      gap:12px;
      transition: width .2s ease;
      overflow: hidden;
    }
  
    /* collapsed */
    .sidebar-collapsed #appSidebar{ width: 84px; }
    .sidebar-collapsed #appSidebar .sb-text,
    .sidebar-collapsed #appSidebar .sb-subtext,
    .sidebar-collapsed #appSidebar .sb-hide-when-collapsed{ display:none !important; }
    .sidebar-collapsed #appSidebar .sb-btn{ justify-content:center; }
    
    .sb-brand{
      display:flex; align-items:center; gap:10px;
      padding:10px;
      border:1px solid var(--line);
      border-radius: 16px;
      background: var(--card2);
    }
    .sb-brand .logo{ width:36px; height:36px; border-radius:12px; box-shadow:none; }
    .sb-brand .sb-text{ font-weight:700; font-size:13px; }
    .sb-brand .sb-subtext{ font-size:11px; color:var(--muted); margin-top:2px; }
  
    .sb-actions{ display:flex; gap:8px; }
    .sb-iconbtn{
      width:42px; height:42px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
    }
  
    .sb-nav{ display:flex; flex-direction:column; gap:8px; margin-top:6px; }
  
    .sb-btn{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      font-size:13px;
    }
    .sb-btn.active{
      border-color: rgba(22,163,74,.35);
      box-shadow: 0 0 0 3px rgba(22,163,74,.12) inset;
    }
    .sb-ico{
      width:32px; height:32px; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      background: var(--card2);
      border:1px solid var(--line);
      font-weight:800;
      color:var(--muted);
    }
  
    .sb-bottom{
      margin-top:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
  
    /* Content area */
    .app-content{
      flex:1;
      min-width:0;
      height: 100vh;
      overflow: hidden;
      display:flex;
      flex-direction:column;
    }
    /* ‡πÄ‡∏î‡∏¥‡∏° .wrap max-width 1200; ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î sidebar ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏î‡πâ */
    .app-content .wrap{
      max-width: 1400px;
    }
  
    /* ‡∏ã‡πà‡∏≠‡∏ô header ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏°‡∏ô‡∏π‡πÑ‡∏õ sidebar) */
    header#appHeader{ display:none; }

    
    #loginError{ display:flex; }
    #loginError.hidden{ display:none !important; }
    
    
    :root{
      /* Light theme */
      --bg:#ffffff;
      --card:#ffffff;
      --card2:#f8fafc;
      --muted:#6b7280;   /* gray-500 */
      --text:#374151;    /* gray-700 */
      --accent:#16a34a;
      --warn:#d97706;
      --danger:#dc2626;
      --line:#e5e7eb;    /* gray-200 */
      --chip:#f3f4f6;    /* gray-100 */
      --btn:#2563eb;
      --btn2:#64748b;
      --shadow: 0 10px 24px rgba(15, 23, 42, .10);
      --radius: 16px;
      --focus: 0 0 0 3px rgba(37,99,235,.15);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg);
      color:var(--text);
    }

    /* App layout visibility */
    .app-hidden{ display:none !important; }

    header{
      position:sticky; top:0; z-index:20;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:16px;}
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:40px; height:40px; border-radius:12px;
      background: linear-gradient(135deg, rgba(37,99,235,.95), rgba(22,163,74,.85));
      box-shadow: var(--shadow);
    }
    .title{ display:flex; flex-direction:column; line-height:1.1; }
    .title b{font-size:14px}
    .title span{font-size:12px; color:var(--muted)}
    .nav{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    .tab{
      border:1px solid var(--line);
      background: #fff;
      color: var(--text);
      padding:10px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-size:13px;
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
    }
    .tab.active{
      border-color: rgba(22,163,74,.35);
      box-shadow: 0 0 0 3px rgba(22,163,74,.12) inset;
    }

    .role-pill{
      padding:8px 10px;
      border-radius:999px;
      background: #fff;
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      display:flex; align-items:center; gap:8px;
    }
    .dot{width:8px; height:8px; border-radius:50%;}
    .dot.lab{background:var(--accent)}
    .dot.pur{background:var(--btn)}
    .grid{ display:grid; gap:16px; }
    .cards{ display:grid; grid-template-columns: 1fr; gap:16px; }
    @media (min-width: 1000px){
      .cards{ grid-template-columns: 1.25fr .75fr; }
    }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h3{
      margin:0;
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      font-size:14px;
      letter-spacing:.2px;
      display:flex; align-items:center; justify-content:space-between;
      background: var(--card2);
    }
    .card .body{padding:14px 16px;}
    .muted{color:var(--muted)}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .spacer{flex:1}

    input, select, textarea{
      width:100%;
      background: #fff;
      border:1px solid var(--line);
      color:var(--text);
      border-radius: 12px;
      padding:10px 12px;
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(37,99,235,.45);
      box-shadow: var(--focus);
    }

    .field{ display:grid; gap:6px; min-width: 180px; }
    .field label{font-size:12px; color:var(--muted)}

    .btn{
      border:0;
      background: linear-gradient(135deg, rgba(37,99,235,.95), rgba(37,99,235,.75));
      color:white;
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      box-shadow: 0 8px 16px rgba(37,99,235,.12);
    }
    .btn.secondary{ background: rgba(100,116,139,.9); box-shadow:none; }
    .btn.ghost{
      background: transparent;
      border:1px solid var(--line);
      color: var(--text);
      box-shadow:none;
    }
    .btn.danger{
      background: linear-gradient(135deg, rgba(220,38,38,.95), rgba(220,38,38,.75));
    }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .chip{
      display:inline-flex;
      align-items:center; gap:6px;
      padding:6px 10px;
      border-radius: 999px;
      background: var(--chip);
      border:1px solid var(--line);
      font-size:12px;
      color: var(--muted);
    }
    .chip strong{color:var(--text); font-weight:600}

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--line);
      background: #fff;
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      font-size:12px;
      vertical-align:top;
    }
    th{
      text-align:left;
      color: var(--muted);
      font-weight:600;
      background: var(--card2);
      position:sticky; top:0;
    }
    tr:last-child td{border-bottom:0}

    .imgph{
      width:42px; height:42px; border-radius:12px;
      background: linear-gradient(135deg, rgba(107,114,128,.20), rgba(107,114,128,.08));
      border:1px solid var(--line);
    }

    .badge{
      display:inline-flex; align-items:center;
      padding:4px 8px; border-radius:999px;
      font-size:11px; font-weight:700;
      border:1px solid var(--line);
      background: var(--chip);
      color: var(--text);
    }
    .badge.new{
      border-color: rgba(22,163,74,.35);
      background: rgba(22,163,74,.10);
      color: #166534;
    }
    .badge.changed{
      border-color: rgba(217,119,6,.35);
      background: rgba(217,119,6,.10);
      color: #92400e;
    }
    .badge.drop{
      border-color: rgba(220,38,38,.35);
      background: rgba(220,38,38,.10);
      color: #991b1b;
    }

    .notice{
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: var(--card2);
      display:flex; gap:10px;
      align-items:flex-start;
    }
    .notice .icon{
      width:18px; height:18px;
      border-radius:6px;
      display:inline-flex;
      align-items:center; justify-content:center;
      font-size:12px;
      margin-top:1px;
      border:1px solid var(--line);
      background:#fff;
    }
    .notice.info .icon{ color:#1d4ed8 }
    .notice.warn .icon{ color:#b45309 }
    .notice.danger .icon{ color:#b91c1c }
    .notice .txt{font-size:12px; color:var(--muted); line-height:1.4}

    .split{ display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 900px){
      .split{grid-template-columns: 1fr 1fr;}
    }
    .section-title{
      font-size:12px;
      color: var(--muted);
      margin:0 0 10px 0;
      letter-spacing:.2px;
    }
    .hr{height:1px; background: var(--line); margin:12px 0;}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
    .hidden{display:none !important}
    .right{ text-align:right }

    /* ------------------------------
       Login Screen
    ------------------------------ */
    .login-wrap{
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;
      background: #fff;
    }
    .login-card{
      width: min(520px, 100%);
      background:#fff;
      border:1px solid var(--line);
      border-radius: 20px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .login-head{
      padding:18px 18px 14px 18px;
      background: var(--card2);
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      gap:12px;
    }
    .login-head .logo{
      width:44px; height:44px; border-radius:14px;
    }
    .login-head .meta{
      display:flex; flex-direction:column; line-height:1.2;
    }
    .login-head .meta b{font-size:14px}
    .login-head .meta span{font-size:12px; color:var(--muted)}
    .login-body{ padding: 18px; }
    .login-actions{ display:flex; gap:10px; align-items:center; margin-top: 14px; }
    .login-actions .btn{ width: 100%; }
    .login-error{ margin-top: 12px; }
    .tiny{ font-size:11px; color: var(--muted); margin-top:10px; }
    
    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ container ‡∏™‡∏π‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î scroll ‡∏ã‡πâ‡∏≠‡∏ô‡∏ú‡∏¥‡∏î‡∏ó‡∏µ‡πà */
    html, body{
      height: 100%;
      margin: 0;
    }
    body{
      overflow: hidden;            /* ‡∏Å‡∏±‡∏ô body scroll */
    }
    
    /* shell ‡∏™‡∏π‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
    #appShell.app-shell{
      height: 100vh;
    }
    
    /* content ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤‡∏™‡∏π‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
    #appShell .app-content{
      flex: 1;
      min-width: 0;
      height: 100vh;
      width: 100%;
      overflow: hidden;            /* ‡∏Å‡∏±‡∏ô scroll ‡∏ã‡πâ‡∏≠‡∏ô */
      display: flex;
      flex-direction: column;
    }
    
    /* ‡πÉ‡∏´‡πâ main ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà scroll ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    #appShell #appMain.wrap{
      display: flex;
      flex-direction: column;
      height: 100%;
      max-width: 100% !important;
      min-height: 0;
      width: 100%;
      margin: 0 auto;
    
      overflow: auto;   /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
      padding: 16px;    /* (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) */
    }
    
    /* ‡πÅ‡∏ï‡πà‡∏•‡∏∞ page ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
    #appMain > section{
      flex: 1;
      min-height: 0;
    }
    
    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á cards ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏™‡∏π‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ card ‡∏¢‡∏∑‡∏î‡∏ï‡∏≤‡∏° */
      #page1 .cards,
      #page2 .cards,
      #page3 .cards{
      height: 100%;
      min-height: 0;
      align-content: stretch;
    }
    
    /* card ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô flex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ body ‡∏¢‡∏∑‡∏î */
    .card{
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    .card .body{
      flex: 1;
      min-height: 0;
    }
    
    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‚Äú‡∏ï‡∏≤‡∏£‡∏≤‡∏á‚Äù ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô scroll ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
    .table-scroll{
      flex: 1;
      min-height: 0;
      overflow: auto;
    }

    /* Page 1 now has only one card */
    #page1 .cards{
      grid-template-columns: 1fr !important;
    }

    #page2 .cards{
  grid-template-columns: 1fr !important;
}    

    /* ‚úÖ Page2 ‡πÄ‡∏û‡∏¥‡πà‡∏° scrollbar ‡πÉ‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
    #page2{
      height: 100%;
      min-height: 0;
    }
    #page2 .card{
      height: 100%;
      min-height: 0;
    }
    #page2 .card .body{
      overflow: auto;
      min-height: 0;
    }

    /* ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå Wash */
    .wash-symbol{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
      padding:10px 12px;
      border:1px dashed var(--line);
      border-radius:14px;
      background: var(--card2);
    }
    .wash-symbol .ico{
      font-size:22px;
      line-height:1;
    }
    .wash-symbol .txt{
      font-size:12px;
      color: var(--muted);
    }
  </style>
</head>

<body>

<!-- ==============================
     LOGIN PAGE (Show first)
============================== -->
<section id="loginPage" class="login-wrap">
  <div class="login-card" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="login-head">
      <div class="logo" aria-hidden="true"></div>
      <div class="meta">
        <b id="loginTitle">TTG-CARE&WASH INSTRUCTIONS</b>
        <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</span>
      </div>
    </div>

    <div class="login-body">
      <div class="field">
        <label>Username</label>
        <input id="loginUsername" autocomplete="username" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Username" />
      </div>

      <div class="field" style="margin-top:10px;">
        <label>Password</label>
        <input id="loginPassword" type="password" autocomplete="current-password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Password" />
      </div>

      <div class="login-actions">
        <button class="btn" id="btnLogin" type="button">Log in</button>
      </div>

      <div id="loginError" class="notice danger hidden login-error">
        <div class="icon">!</div>
        <div class="txt">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div>
      </div>

      <div class="tiny">
        * Prototype: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ö‡∏ö Hardcoded (‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡πÉ‡∏ô JS ‡∏™‡πà‡∏ß‡∏ô <span class="mono">AUTH</span>)
      </div>
    </div>
  </div>
</section>

<!-- ==============================
     APP (Hidden until login)
============================== -->
<div id="appShell" class="app-shell app-hidden">

  <!-- Sidebar -->
  <aside id="appSidebar">
    <div class="sb-brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="sb-hide-when-collapsed">
        <div class="sb-text">TTG-CARE&WASH</div>
        <div class="sb-subtext">INSTRUCTIONS</div>
      </div>
      <div class="spacer"></div>
      <button class="sb-iconbtn" id="btnToggleSidebar" title="‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏°‡∏ô‡∏π">‚â°</button>
    </div>

    <div class="sb-nav">
      <button class="sb-btn active tab" data-page="page1">
        <!-- <span class="sb-ico">1</span> -->
        <span class="sb-text">Style Worklist</span>
      </button>

     <button class="sb-btn tab" data-page="page3">
        <!-- <span class="sb-ico">3</span> -->
        <span class="sb-text">Order Form</span>
     </button>
    </div>

    <div class="sb-bottom">
      <div class="role-pill sb-hide-when-collapsed" title="‡∏à‡∏≥‡∏•‡∏≠‡∏á Role">
        <span class="dot lab" id="roleDot"></span>
        <span id="roleLabel">Role: LAB</span>
        <span class="spacer"></span>
        <select id="roleSelect" style="width:160px; padding:8px 10px; border-radius:999px;">
          <option value="LAB" selected>LAB</option>
          <option value="PUR">Purchasing</option>
        </select>
      </div>

      <button class="btn ghost" id="btnLogout" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">Logout</button>
    </div>
  </aside>

  <!-- Content -->
  <div class="app-content">
    <main id="appMain" class="wrap">
      <!-- PAGE 1 -->
      <section id="page1"> 
      <div class="cards">
        <div class="card"><h3><span>Style Worklist</span></h3>
          <div class="body">
            <div class="row">
              <div class="field" style="min-width:220px"><label>Style No</label>
                <input id="searchStyle" placeholder="" />
              </div>
              <div class="field">
                <label>Season</label>
                <select id="filterSeason">
                  <option value="">All</option>
                  <option>SS26</option>
                  <option>FW25</option>
                </select>
              </div>
              <div class="field">
                <label>Development Type</label>
                <select id="filterDevType">
                  <option value="">All</option>
                  <option>NEW STYLE</option>
                  <option>CARRY OVER</option>
                </select>
              </div>
              <div class="spacer"></div>
            </div>
            <div class="hr"></div>
            <div class="table-scroll" style="margin-top:12px;">
              <table>
                <thead>
                  <tr>
                    <th class="right" style="min-width:110px">Action</th>
                    <th style="min-width:70px">Style Image</th>
                    <th style="min-width:120px">Style No</th>
                    <th style="min-width:160px">Style Name</th>
                    <th>Season</th>
                    <th>Gender</th>
                    <th>Base Size</th>
                    <th style="min-width:160px">Product Name</th>
                    <th style="min-width:110px">Style Status</th>
                    <th>Stage</th>
                    <th style="min-width:120px">Product Type</th>
                    <th style="min-width:150px">Sport Category (BU)</th>
                    <th style="min-width:130px">Buy Ready Date</th>
                    <th style="min-width:110px">T1 Develop</th>
                    <th style="min-width:140px">Development Type</th>
                    <th style="min-width:140px">Status Indicator</th>
                  </tr>
                </thead>
                <tbody id="styleTbody"></tbody>
              </table>
            </div>
          </div>
        </div>
        </div>
      </section>

      <!-- PAGE 2 -->
      <section id="page2" class="hidden"> <div class="cards">
          <div class="card">
            <h3><span>Care & Wash Instructions</span></h3>
            <div class="body">
              <div id="p2NoStyle" class="notice warn">
                <div class="icon">!</div>
                <div class="txt">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Style ‡∏Å‡πà‡∏≠‡∏ô</div>
              </div>
    
              <div id="p2Content" class="hidden">
                <div class="split">
                  <div>
                    <p class="section-title">Style Information</p>
                    <div class="row">
                      <span class="chip">Style No: <strong id="p2StyleNo">-</strong></span>
                      <span class="chip">Season: <strong id="p2Season">-</strong></span>
                      <span class="chip">Development Type: <strong id="p2DevType">-</strong></span>
                      <span class="chip">Sport Category (BU): <strong id="p2BU">-</strong></span>
                    </div>
                  </div>
    
                  <div>
                    <p class="section-title">Carry Over (Reference)</p>
                    <div class="row" style="margin-top:10px;">
                      <div class="field" style="min-width:220px;">
                        <!-- <label>Reference Season (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Carry Over)</label> -->
                        <select id="refSeason" disabled>
                          <option value="">-</option>
                          <option value="SS25">SS25</option>
                          <option value="FW24">FW24</option>
                        </select>
                      </div>
                      <button class="btn secondary" id="btnLoadReference" disabled>Load Reference</button>
                    </div>
                  </div>
                </div>
    
                <div class="hr"></div>
    
                <p class="section-title">BOM / Fabric (Filtered by LAB Formula - Demo)</p>
                <div style="overflow:auto; max-height: 260px;">
                  <table>
                    <thead>
                      <tr>
                        <th style="min-width:140px">Material Code</th>
                        <th style="min-width:220px">Material Name</th>
                        <th style="min-width:160px">Composition (%)</th>
                        <th style="min-width:110px" class="right">Usage %</th>
                        <th style="min-width:140px">Included?</th>
                      </tr>
                    </thead>
                    <tbody id="bomTbody"></tbody>
                  </table>
                </div>
    
                <div class="hr"></div>
                <div id="saveStatusBox" style="margin-top:12px;"></div>

                <div class="notice danger hidden" id="careValidationBanner">
                  <div class="icon">!</div>
                  <div class="txt" id="careValidationText">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Care Symbol ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å Material ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                  </div>
                </div>
    
                <p class="section-title" style="margin-top:10px;">Care Symbol & Extra Care Selection (‡∏ï‡πà‡∏≠ Material)</p>
                <div id="careBlocks"></div>
    
                <div class="hr"></div>
    
                <div class="row">
                  <button class="btn ghost" id="btnBackToP1">Back to Worklist</button>
                  <div class="spacer"></div>
                  <button class="btn secondary" id="btnResetCare">Reset Selections</button>
                  <button class="btn" id="btnSaveCare">Cancel</button>
                  <button class="btn" id="btnSaveCare">Save</button>
                </div>
    
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PAGE 3 -->
      <section id="page3" class="hidden"> <div class="cards">
          <div class="card">
            <h3>
              <span>Order Form</span>
            </h3>
            <div class="body">
    
              <div id="p3NoData" class="notice warn">
                <div class="icon">!</div>
                <div class="txt">‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà LAB ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>
              </div>
    
              <div id="p3Content" class="hidden">
                <p class="section-title">Style Summary</p>
                <div class="row">
                  <span class="chip">Style No: <strong id="p3StyleNo">-</strong></span>
                  <span class="chip">Season: <strong id="p3Season">-</strong></span>
                  <span class="chip">Development Type: <strong id="p3DevType">-</strong></span>
                  <span class="chip">Supplier Doc: <strong>Order Form (AD PDF)</strong></span>
                  <span class="spacer"></span>
                  <span class="badge" id="p3ReadyBadge">READY</span>
                </div>
    
                <div class="hr"></div>
    
                <p class="section-title">LAB Saved Care Label</p>
                <div style="overflow:auto; max-height: 260px;">
                  <table>
                    <thead>
                      <tr>
                        <th style="min-width:140px">Material Code</th>
                        <th style="min-width:220px">Material Name</th>
                        <th style="min-width:160px">Composition (%)</th>
                        <th style="min-width:220px">Care Symbol (Selected)</th>
                        <th style="min-width:220px">Extra Care (Selected)</th>
                      </tr>
                    </thead>
                    <tbody id="p3CareTbody"></tbody>
                  </table>
                </div>
    
                <div class="hr"></div>
    
                <div class="split">
                  <div>
                    <p class="section-title">Fiber Text Position (Purchasing Editable)</p>
                    <div class="field">
                      <label>Fiber Text Position</label>
                      <input id="fiberPosition" placeholder="‡πÄ‡∏ä‡πà‡∏ô LEFT SIDE / NECK LABEL / HEM ..." />
                    </div>
                    <div class="notice info" style="margin-top:10px;">
                      <div class="icon">i</div>
                      <div class="txt">‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Fiber Text Position ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Master BOM)</div>
                    </div>
                  </div>
    
                  <div>
                    <p class="section-title">Generate</p>
                    <div class="notice warn hidden" id="p3ValidationBanner">
                      <div class="icon">!</div>
                      <div class="txt" id="p3ValidationText"></div>
                    </div>
                    <div class="row" style="margin-top:10px;">
                      <button class="btn secondary" id="btnPreviewPdf">Preview (Mock)</button>
                      <button class="btn" id="btnGeneratePdf">Generate AD PDF (Mock)</button>
                    </div>
                    <div id="pdfResult" style="margin-top:12px;"></div>
                  </div>
                </div>
    
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>


<script>
  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô user/pass ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ (Prototype)
  const AUTH = { username: 'admin', password: '1234' };
  
  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö onclick ‡∏´‡∏£‡∏∑‡∏≠ debug)
  window.doLogin = doLogin;
  window.showApp = showApp;
  
 function showLoginError(show, msg){
  const el = document.getElementById('loginError');
  if(!el) return;
  
  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
  const txt = el.querySelector('.txt');
  if(txt) txt.textContent = msg || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ';
  
  // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô
  el.classList.toggle('hidden', !show);
  
  // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î ‡πÜ
  if(show){
    el.scrollIntoView({ behavior:'smooth', block:'center' });
    }
  }
  
 function showApp(){
  document.getElementById('loginPage')?.classList.add('hidden');
  document.getElementById('appShell')?.classList.remove('app-hidden');

  // optional: ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏≠‡∏õ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ expanded
  document.body.classList.remove('sidebar-collapsed');
}

function showLogin(){
  document.getElementById('loginPage')?.classList.remove('hidden');
  document.getElementById('appShell')?.classList.add('app-hidden');

  // ‚úÖ reset sidebar state
  document.body.classList.remove('sidebar-collapsed');

  showLoginError(false);
  const pw = document.getElementById('loginPassword');
  if(pw) pw.value = '';
}

  
 function doLogin(e){
    if(e) e.preventDefault();
  
    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    showLoginError(false);
  
    const u = (document.getElementById('loginUsername')?.value || '').trim();
    const p = (document.getElementById('loginPassword')?.value || '').trim();
  
    // ‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
    if(!u || !p){
      showLoginError(true, '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Username ‡πÅ‡∏•‡∏∞ Password');
      return;
    }
  
    if(u === AUTH.username && p === AUTH.password){
      showLoginError(false);
      showApp();
      if(typeof initAppOnce === 'function') initAppOnce();
    }else{
      showLoginError(true, 'Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
    }
  }
  
  function bindLoginEvents(){
    const btn  = document.getElementById('btnLogin');
    const user = document.getElementById('loginUsername');
    const pass = document.getElementById('loginPassword');
    if(!btn || !user || !pass) return;
    
    // ‡∏Å‡∏±‡∏ô bind ‡∏ã‡πâ‡∏≥ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏≠‡∏ô DOMContentLoaded ‡πÅ‡∏ô‡πà ‡πÜ)
    if(btn.dataset.bound === '1') return;
    btn.dataset.bound = '1';
  
    // bind
    btn.addEventListener('click', doLogin);
    
    user.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') doLogin(e); });
    pass.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') doLogin(e); });
  }
  
  // ‚úÖ bind ‡πÅ‡∏Ñ‡πà‡∏ï‡∏≠‡∏ô DOM ‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏∏‡∏î)
  document.addEventListener('DOMContentLoaded', bindLoginEvents);


  // ------------------------------
  // Mock Data
  // ------------------------------
  const state = {
    role: 'LAB',
    page: 'page1',
    selectedStyleId: null,
    labSaved: null,         // { styleId, materials: [...], carryRef: {...}, savedAt }
    audit: [],
  };

  const styles = [
    {
      id: 'S1',
      styleNo: 'RBK-SS26-001',
      styleName: 'Runner Tee',
      season: 'SS26',
      gender: 'Men',
      baseSize: 'M',
      productName: 'Performance Tee',
      styleStatus: 'IN RANGE',
      stage: 'SMS',
      productType: 'Apparel',
      bu: 'Running',
      buyReadyDate: '2026-01-08',
      t1Develop: 'YES',
      developmentType: 'NEW STYLE',
      indicator: 'NEW'
    },
    {
      id: 'S2',
      styleNo: 'RBK-SS26-014',
      styleName: 'Studio Tank',
      season: 'SS26',
      gender: 'Women',
      baseSize: 'S',
      productName: 'Training Tank',
      styleStatus: 'IN RANGE',
      stage: 'SMS',
      productType: 'Apparel',
      bu: '',
      buyReadyDate: '2026-01-12',
      t1Develop: 'NO',
      developmentType: 'CARRY OVER',
      indicator: 'CHANGED'
    },
    {
      id: 'S3',
      styleNo: 'RBK-FW25-008',
      styleName: 'Classic Hoodie',
      season: 'FW25',
      gender: 'Unisex',
      baseSize: 'L',
      productName: 'Fleece Hoodie',
      styleStatus: 'DROP',
      stage: 'DEV',
      productType: 'Apparel',
      bu: 'Lifestyle',
      buyReadyDate: '2025-10-02',
      t1Develop: 'YES',
      developmentType: 'NEW STYLE',
      indicator: 'CHANGED'
    },
  ];

  const bomByStyle = {
    S1: [
      { code:'FAB-001', name:'Single Jersey', comp:'Cotton 60% / Polyester 40%', usage: 55 },
      { code:'FAB-020', name:'Mesh Panel', comp:'Cotton 60% / Polyester 40%', usage: 22 },
    ],
    S2: [
      { code:'FAB-002', name:'Interlock', comp:'Polyester 88% / Spandex 12%', usage: 68 },
    ],
  };

  const masterCare = [
  // ‚úÖ Wash Instructions (‡∏°‡∏µ symbol)
  { id:'CW001', group:'Wash Instructions', label:'MACHINE WASH COLD',         symbol:'‚ùÑÔ∏è' },
  { id:'CW002', group:'Wash Instructions', label:'MACHINE WASH COLD GENTLE',  symbol:'üß∫' },
  { id:'CW005', group:'Wash Instructions', label:'HAND WASH',                 symbol:'ü§≤' },

  // Bleach / Dry (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ symbol ‡∏Å‡πá‡πÑ‡∏î‡πâ)
  { id:'CB001', group:'Bleach Instructions', label:'ONLY NON-CHLORINE BLEACH WHEN NEEDED' },
  { id:'CB002', group:'Bleach Instructions', label:'DO NOT BLEACH' },
  { id:'CD001', group:'Dry Instructions',    label:'TUMBLE DRY LOW' },
  { id:'CD002', group:'Dry Instructions',    label:'TUMBLE DRY MEDIUM' },
  { id:'CD010', group:'Dry Instructions',    label:'TUMBLE DRY HIGH' },
  ];

  const masterExtra = [
    { id:'EC01', label:'DO NOT IRON ON PRINT' },
    { id:'EC02', label:'WASH WITH LIKE COLORS' },
    { id:'EC03', label:'DO NOT DRY CLEAN' },
  ];

  const carryOverRef = {
    SS25: {
      careByMaterialCode: {
        'FAB-002': ['CW002','CB002','CD001'],
        'FAB-021': ['CW001','CB001','CD002']
      },
      extraByMaterialCode: {
        'FAB-002': ['EC02'],
        'FAB-021': ['EC01']
      }
    },
    FW24: {
      careByMaterialCode: {
        'FAB-002': ['CW001','CB002','CD001'],
        'FAB-021': ['CW001','CB002','CD001']
      },
      extraByMaterialCode: {
        'FAB-002': ['EC03'],
        'FAB-021': []
      }
    }
  };

  // ------------------------------
  // Helpers
  // ------------------------------
  function renderWashSymbolHtml(careId){
    if(!careId){
      return `<div class="ico">üß∫</div><div class="txt">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Wash Instructions</div>`;
    }
    const item = masterCare.find(x => x.id === careId);
    const ico = item?.symbol || 'üß∫';
    const txt = item?.label || careId;
    return `<div class="ico">${ico}</div><div class="txt">${escapeHtml(txt)}</div>`;
  }


  
  function logAudit(msg){
    const t = new Date().toLocaleString();
    state.audit.unshift(`[${t}] ${msg}`);
    renderAudit();
  }
  function renderAudit(){
    const el = document.getElementById('auditLog');
    el.innerHTML = state.audit.map(x => `<div>${escapeHtml(x)}</div>`).join('');
  }
  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
    }[s]));
  }
  function setPage(pageId){
    state.page = pageId;
    document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
    document.getElementById(pageId).classList.remove('hidden');
    document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.page === pageId));

    if(pageId === 'page1') renderPage1();
    if(pageId === 'page2') renderPage2();
    if(pageId === 'page3') renderPage3();
  }
  function setRole(role){
    state.role = role;
    const dot = document.getElementById('roleDot');
    const label = document.getElementById('roleLabel');
    dot.classList.toggle('lab', role === 'LAB');
    dot.classList.toggle('pur', role === 'PUR');
    label.textContent = `Role: ${role === 'LAB' ? 'LAB' : 'Purchasing'}`;

    renderPage2();
    renderPage3();
  }
  function getSelectedStyle(){
    return styles.find(s => s.id === state.selectedStyleId) || null;
  }
  function filteredStyles(){
    const q = document.getElementById('searchStyle')?.value?.trim().toLowerCase() || '';
    const season = document.getElementById('filterSeason')?.value || '';
    const devType = document.getElementById('filterDevType')?.value || '';

    return styles
      .filter(s => !q || (s.styleNo.toLowerCase().includes(q) || s.styleName.toLowerCase().includes(q)))
      .filter(s => !season || s.season === season)
      .filter(s => !devType || s.developmentType === devType)
  }

  // ------------------------------
  // Page 1 Rendering
  // ------------------------------
  function renderPage1(){
    const tbody = document.getElementById('styleTbody');
    const rows = filteredStyles().map(s => {
      const indicatorBadge =
        s.indicator === 'NEW'
          ? `<span class="badge new">NEW</span>`
          : `<span class="badge changed">CHANGED</span>`;

      const statusBadge =
        s.styleStatus === 'DROP'
          ? `<span class="badge drop">DROP</span>`
          : `<span class="badge">${escapeHtml(s.styleStatus || '-')}</span>`;

      const buText = s.bu ? escapeHtml(s.bu) : `<span class="muted">-</span>`;

      return `
        <tr>
          <td class="right">
            <button class="btn" onclick="selectStyle('${s.id}')">Select</button>
          </td>
          <td><div class="imgph" title="Style Image (Mock)"></div></td>
          <td class="mono">${escapeHtml(s.styleNo)}</td>
          <td>${escapeHtml(s.styleName)}</td>
          <td>${escapeHtml(s.season)}</td>
          <td>${escapeHtml(s.gender)}</td>
          <td>${escapeHtml(s.baseSize)}</td>
          <td>${escapeHtml(s.productName)}</td>
          <td>${statusBadge}</td>
          <td><span class="badge">${escapeHtml(s.stage)}</span></td>
          <td>${escapeHtml(s.productType)}</td>
          <td>${buText}</td>
          <td>${escapeHtml(s.buyReadyDate)}</td>
          <td>${escapeHtml(s.t1Develop)}</td>
          <td><span class="badge">${escapeHtml(s.developmentType)}</span></td>
          <td>${indicatorBadge}</td>
        </tr>
      `;
    }).join('');

    tbody.innerHTML = rows || `<tr><td colspan="16" class="muted">No results</td></tr>`;
  }

  function renderSelectedStyleCard(){
    const box = document.getElementById('selectedStyleCard');
    const s = getSelectedStyle();
    if(!s){
      box.innerHTML = `
        <div class="notice warn">
          <div class="icon">!</div>
          <div class="txt">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Style ‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Worklist ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÉ‡∏ô Page 2</div>
        </div>`;
      return;
    }
    box.innerHTML = `
      <div class="row">
        <span class="chip">Style No: <strong class="mono">${escapeHtml(s.styleNo)}</strong></span>
        <span class="chip">Style Name: <strong>${escapeHtml(s.styleName)}</strong></span>
        <span class="chip">Season: <strong>${escapeHtml(s.season)}</strong></span>
      </div>
      <div class="hr"></div>
      <div class="row">
        <span class="chip">Development Type: <strong>${escapeHtml(s.developmentType)}</strong></span>
        <span class="chip">Style Status (Ref): <strong>${escapeHtml(s.styleStatus || '-')}</strong></span>
        <span class="chip">BU (Ref): <strong>${escapeHtml(s.bu || '-')}</strong></span>
      </div>
      <div style="margin-top:12px" class="row">
        <button class="btn" onclick="goToPage2()">Proceed to Page 2</button>
        <button class="btn ghost" onclick="goToPage3()">Go to Page 3</button>
      </div>
    `;
  }

  window.selectStyle = function(styleId){
    state.selectedStyleId = styleId;
  
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Style ‡πÉ‡∏´‡πâ reset ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢ save ‡∏Ç‡∏≠‡∏á style ‡πÄ‡∏Å‡πà‡∏≤ (‡∏Ñ‡∏á logic ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ)
    if(state.labSaved?.styleId !== styleId){
      state.labSaved = null;
    }
  
    logAudit(`Selected Style: ${styles.find(s=>s.id===styleId)?.styleNo || styleId}`);
  
    // ‚úÖ ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Page 2 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    setPage('page2');
  };
  window.goToPage2 = function(){ setPage('page2'); }
  window.goToPage3 = function(){ setPage('page3'); }

  // ------------------------------
  // Page 2 Rendering + Logic
  // ------------------------------
  function renderPage2(){
    const s = getSelectedStyle();
    const noStyle = document.getElementById('p2NoStyle');
    const content = document.getElementById('p2Content');

    if(!s){
      noStyle.classList.remove('hidden');
      content.classList.add('hidden');
      return;
    }
    noStyle.classList.add('hidden');
    content.classList.remove('hidden');

    document.getElementById('p2StyleNo').textContent = s.styleNo;
    document.getElementById('p2Season').textContent = s.season;
    document.getElementById('p2DevType').textContent = s.developmentType;
    document.getElementById('p2BU').textContent = s.bu || '-';

    const isCarry = s.developmentType === 'CARRY OVER';
    document.getElementById('refSeason').disabled = !isCarry;
    document.getElementById('btnLoadReference').disabled = !isCarry;

    const bom = (bomByStyle[s.id] || []).map(x => ({ ...x, included: x.usage > 15 }));

    const bomTbody = document.getElementById('bomTbody');
    bomTbody.innerHTML = bom.map(x => `
      <tr>
        <td class="mono">${escapeHtml(x.code)}</td>
        <td>${escapeHtml(x.name)}</td>
        <td>${escapeHtml(x.comp)}</td>
        <td class="right">${x.usage}%</td>
        <td>${x.included ? `<span class="badge new">YES</span>` : `<span class="badge">NO</span>`}</td>
      </tr>
    `).join('') || `<tr><td colspan="5" class="muted">No BOM data</td></tr>`;

    const materials = bom.filter(x => x.included);
    renderCareBlocks(s, materials);

    const saveBox = document.getElementById('saveStatusBox');
    if(saveBox){
      if(state.labSaved && state.labSaved.styleId === s.id){
        saveBox.innerHTML = `
          <div class="notice info">
          <div class="icon">‚úì</div>
          <div class="txt">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß: <span class="mono">${escapeHtml(state.labSaved.savedAt)}</span><br/>
            Materials saved: <b>${state.labSaved.materials.length}</b>
          </div>
        </div>`;
    }else{
      saveBox.innerHTML = `
        <div class="notice info">
          <div class="icon">i</div>
          <div class="txt">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Care Label</div>
        </div>`;
      }
    }

    document.getElementById('careValidationBanner').classList.add('hidden');
  }

  function renderCareBlocks(style, materials){
    const container = document.getElementById('careBlocks');
    const saved = (state.labSaved && state.labSaved.styleId === style.id) ? state.labSaved : null;
  
    container.innerHTML = materials.map(m => {
      const savedCare = saved?.materials?.find(x => x.code === m.code)?.careIds || [];
      const savedExtra = saved?.materials?.find(x => x.code === m.code)?.extraIds || [];
  
      const groups = [...new Set(masterCare.map(c => c.group))];
  
      // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ‡∏ï‡πà‡∏≠ group (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
      const groupHtml = groups.map(g => {
        const options = masterCare
          .filter(c => c.group === g)
          .map(c => {
            const selected = savedCare.includes(c.id) ? 'selected' : '';
            return `<option value="${c.id}" ${selected}>${escapeHtml(c.label)} (${escapeHtml(c.id)})</option>`;
          }).join('');
  
        // ‡∏´‡∏≤ id ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô group ‡∏ô‡∏µ‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const selectedIdInGroup =
          savedCare.find(id => masterCare.find(x => x.id === id && x.group === g)?.id) || '';
  
        return `
          <div style="padding:10px 12px; border:1px solid var(--line); border-radius:14px; background:var(--card2); margin-top:10px;">
            <div class="muted" style="font-size:12px; font-weight:700; letter-spacing:.2px;">${escapeHtml(g)}</div>
  
            <div class="row" style="margin-top:8px;">
              <div class="field" style="min-width:320px;">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                <select class="careSel" data-mcode="${escapeHtml(m.code)}" data-group="${escapeHtml(g)}">
                  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                  ${options}
                </select>
              </div>
  
              ${
                g === 'Wash Instructions'
                ? `
                  <div id="washSymbol_${escapeHtml(m.code)}" class="wash-symbol" style="flex:1; min-width:220px;">
                    ${renderWashSymbolHtml(selectedIdInGroup)}
                  </div>
                `
                : ''
              }
            </div>
          </div>
        `;
      }).join('');
  
      const extraOptions = masterExtra.map(e => {
        const checked = savedExtra.includes(e.id) ? 'checked' : '';
        return `
          <label style="display:flex; gap:8px; align-items:center; padding:6px 0;">
            <input type="checkbox" data-mcode="${m.code}" class="extraChk" value="${e.id}" ${checked} style="width:auto;">
            <span>${escapeHtml(e.label)} <span class="muted mono">(${escapeHtml(e.id)})</span></span>
          </label>`;
      }).join('');
  
      return `
        <div class="card" style="margin-top:12px;">
          <h3>
            <span>Material: <span class="mono">${escapeHtml(m.code)}</span> ‚Äî ${escapeHtml(m.name)}</span>
            <span class="chip">Usage: <strong>${m.usage}%</strong></span>
          </h3>
  
          <div class="body">
            <div class="row">
              <span class="chip">Composition: <strong>${escapeHtml(m.comp)}</strong></span>
            </div>
  
            ${groupHtml}
  
            <div class="hr"></div>
            <div>
              <div class="muted" style="font-size:12px; font-weight:700; letter-spacing:.2px;">Extra Care Instruction (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</div>
              <div style="padding-top:6px;">${extraOptions}</div>
            </div>
          </div>
        </div>
      `;
    }).join('') || `
      <div class="notice warn">
        <div class="icon">!</div>
        <div class="txt">‡πÑ‡∏°‡πà‡∏°‡∏µ Material ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á (Usage > 15% ‡πÉ‡∏ô Demo)</div>
      </div>
    `;
  }


  function validateCareSelections(materialCodes){
    for (const code of materialCodes){
      const selectedAny = [...document.querySelectorAll(`.careSel[data-mcode="${code}"]`)]
        .some(sel => (sel.value || '').trim() !== '');
      if(!selectedAny) return { ok:false, code };
    }
    return { ok:true };
  }


  function collectSelectionsForMaterials(materials){
    return materials.map(m => {
      const careIds = [...document.querySelectorAll(`.careSel[data-mcode="${m.code}"]`)]
        .map(sel => (sel.value || '').trim())
        .filter(v => v !== '');
  
      const extraIds = [...document.querySelectorAll(`.extraChk[data-mcode="${m.code}"]:checked`)]
        .map(x => x.value);
  
      return { code: m.code, name: m.name, comp: m.comp, usage: m.usage, careIds, extraIds };
    });
  }

  // ------------------------------
  // Page 3 Rendering + Logic
  // ------------------------------
  function renderPage3(){
    const s = getSelectedStyle();
    const hasSaved = state.labSaved && s && state.labSaved.styleId === s.id;

    const noData = document.getElementById('p3NoData');
    const content = document.getElementById('p3Content');

    if(!s || !hasSaved){
      noData.classList.remove('hidden');
      content.classList.add('hidden');
      return;
    }

    noData.classList.add('hidden');
    content.classList.remove('hidden');

    document.getElementById('p3StyleNo').textContent = s.styleNo;
    document.getElementById('p3Season').textContent = s.season;
    document.getElementById('p3DevType').textContent = s.developmentType;

    const tbody = document.getElementById('p3CareTbody');
    tbody.innerHTML = state.labSaved.materials.map(m => {
      const careTxt = m.careIds.map(id => {
        const item = masterCare.find(x => x.id === id);
        return `${id} - ${item ? item.label : ''}`.trim();
      }).join('<br/>') || '<span class="muted">-</span>';

      const extraTxt = m.extraIds.map(id => {
        const item = masterExtra.find(x => x.id === id);
        return `${id} - ${item ? item.label : ''}`.trim();
      }).join('<br/>') || '<span class="muted">-</span>';

      return `
        <tr>
          <td class="mono">${escapeHtml(m.code)}</td>
          <td>${escapeHtml(m.name)}</td>
          <td>${escapeHtml(m.comp)}</td>
          <td>${careTxt}</td>
          <td>${extraTxt}</td>
        </tr>
      `;
    }).join('');

    updateP3ReadyBadge();
  }

  function updateP3ReadyBadge(){
    const badge = document.getElementById('p3ReadyBadge');
    const fiber = document.getElementById('fiberPosition')?.value?.trim() || '';
    if(fiber){
      badge.className = 'badge new';
      badge.textContent = 'READY';
    }else{
      badge.className = 'badge changed';
      badge.textContent = 'MISSING FIBER POSITION';
    }
  }

  function validateBeforeGenerate(){
    const fiber = document.getElementById('fiberPosition').value.trim();
    if(!fiber){
      return { ok:false, msg:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ Fiber Text Position ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£' };
    }
    return { ok:true };
  }

  // ------------------------------
  // App Events
  // ------------------------------
  function bindAppEvents(){
    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => setPage(btn.dataset.page));
    });
  
    document.getElementById('roleSelect')?.addEventListener('change', (e) => setRole(e.target.value));
  
    document.getElementById('searchStyle')?.addEventListener('input', renderPage1);
    document.getElementById('filterSeason')?.addEventListener('change', renderPage1);
  
    // ‚úÖ ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠ 2: DevType ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    document.getElementById('filterDevType')?.addEventListener('change', renderPage1);
  
    // ‚úÖ ‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á: ‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô HTML ‡∏Å‡πá‡πÑ‡∏°‡πà error
    document.getElementById('filterGender')?.addEventListener('change', renderPage1);
    document.getElementById('filterStyleStatus')?.addEventListener('change', renderPage1);
  
    document.getElementById('resetFilters')?.addEventListener('click', () => {
      const a = document.getElementById('searchStyle'); if(a) a.value = '';
      const b = document.getElementById('filterSeason'); if(b) b.value = '';
      const d = document.getElementById('filterDevType'); if(d) d.value = '';
      renderPage1();
    });
  
    document.getElementById('btnBackToP1')?.addEventListener('click', () => setPage('page1'));
  
    document.getElementById('btnResetCare')?.addEventListener('click', () => {
      document.querySelectorAll('.careChk:checked, .extraChk:checked').forEach(x => x.checked = false);
      document.getElementById('careValidationBanner')?.classList.add('hidden');
    });
  
    document.getElementById('btnSaveCare')?.addEventListener('click', () => {
      const s = getSelectedStyle();
      if(!s) return;
  
      const bom = (bomByStyle[s.id] || []).map(x => ({...x, included: x.usage > 15}));
      const materials = bom.filter(x => x.included);
  
      const validation = validateCareSelections(materials.map(m => m.code));
      if(!validation.ok){
        const banner = document.getElementById('careValidationBanner');
        banner?.classList.remove('hidden');
        document.getElementById('careValidationText').textContent =
          `Material ${validation.code} ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Care Symbol ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        banner?.scrollIntoView({ behavior:'smooth', block:'center' });
        return;
      }
  
      const payload = {
        styleId: s.id,
        materials: collectSelectionsForMaterials(materials),
        carryRef: null,
        savedAt: new Date().toLocaleString()
      };
  
      const refSeason = document.getElementById('refSeason')?.value || '';
      if(s.developmentType === 'CARRY OVER' && refSeason){
        payload.carryRef = { season: refSeason, mode: 'Reference (editable)' };
      }
  
      state.labSaved = payload;
      logAudit(`LAB Saved Care Label for ${s.styleNo} (materials: ${payload.materials.length})`);
      if(payload.carryRef) logAudit(`Carry Over Reference used: ${payload.carryRef.season}`);
  
      renderPage2();
      renderPage3();
    });
  
    document.getElementById('btnLoadReference')?.addEventListener('click', () => {
      const s = getSelectedStyle();
      if(!s) return;
  
      const season = document.getElementById('refSeason')?.value || '';
      if(!season){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Reference Season'); return; }
  
      const bom = (bomByStyle[s.id] || []).map(x => ({...x, included: x.usage > 15}));
      const materials = bom.filter(x => x.included);
  
      document.querySelectorAll('.careChk:checked, .extraChk:checked').forEach(x => x.checked = false);
  
      const ref = carryOverRef[season];
      if(ref){
        materials.forEach(m => {
          (ref.careByMaterialCode[m.code] || []).forEach(id => {
            const cb = document.querySelector(`.careChk[data-mcode="${m.code}"][value="${id}"]`);
            if(cb) cb.checked = true;
          });
          (ref.extraByMaterialCode[m.code] || []).forEach(id => {
            const cb = document.querySelector(`.extraChk[data-mcode="${m.code}"][value="${id}"]`);
            if(cb) cb.checked = true;
          });
        });
        logAudit(`Loaded Carry Over Reference for ${s.styleNo} from Season ${season}`);
      }else{
        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ç‡∏≠‡∏á Season ‡∏ô‡∏µ‡πâ (Demo)');
      }
    });
  
    document.getElementById('fiberPosition')?.addEventListener('input', () => {
      updateP3ReadyBadge();
      document.getElementById('p3ValidationBanner')?.classList.add('hidden');
    });
  
    document.getElementById('btnPreviewPdf')?.addEventListener('click', () => {
      const v = validateBeforeGenerate();
      const banner = document.getElementById('p3ValidationBanner');
      if(!v.ok){
        banner?.classList.remove('hidden');
        document.getElementById('p3ValidationText').textContent = v.msg;
        return;
      }
      document.getElementById('pdfResult').innerHTML = `
        <div class="notice info">
          <div class="icon">i</div>
          <div class="txt">Preview PDF (Mock): ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ‚Äî (Prototype ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á)</div>
        </div>`;
      logAudit('Preview AD PDF (Mock)');
    });
  
    document.getElementById('btnGeneratePdf')?.addEventListener('click', () => {
      const v = validateBeforeGenerate();
      const banner = document.getElementById('p3ValidationBanner');
      if(!v.ok){
        banner?.classList.remove('hidden');
        document.getElementById('p3ValidationText').textContent = v.msg;
        return;
      }
      banner?.classList.add('hidden');
  
      const s = getSelectedStyle();
      const fiber = document.getElementById('fiberPosition')?.value?.trim() || '';
  
      document.getElementById('pdfResult').innerHTML = `
        <div class="notice info">
          <div class="icon">‚úì</div>
          <div class="txt">
            Generate AD PDF (Mock) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<br/>
            Style: <span class="mono">${escapeHtml(s.styleNo)}</span><br/>
            Fiber Text Position: <b>${escapeHtml(fiber)}</b>
          </div>
        </div>`;
      logAudit(`Generated AD PDF (Mock) for ${s.styleNo}`);
    });
  
    // ‚úÖ ‡∏Ç‡πâ‡∏≠ 1: Logout ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ event bind ‡πÑ‡∏°‡πà‡∏û‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß
    document.getElementById('btnLogout')?.addEventListener('click', () => {
      showLogin();
    });
  
    document.getElementById('btnToggleSidebar')?.addEventListener('click', () => {
      document.body.classList.toggle('sidebar-collapsed');
    });

    // ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å dropdown ‡πÉ‡∏ô Wash Instructions ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    document.addEventListener('change', (e) => {
      const sel = e.target;
      if(!sel || !sel.classList || !sel.classList.contains('careSel')) return;
    
      const mcode = sel.dataset.mcode;
      const group = sel.dataset.group;
      if(group !== 'Wash Instructions') return;
    
      const box = document.getElementById(`washSymbol_${mcode}`);
      if(!box) return;
    
      box.innerHTML = renderWashSymbolHtml(sel.value);
    });
  }

  // ------------------------------
  // Init App (Run once after login)
  // ------------------------------
  let appInited = false;

  function initAppOnce(){
    if(appInited) return;
    appInited = true;

    bindAppEvents();

    // role
    setRole('LAB');
    // first render
    renderPage1();
    renderAudit();

    const originalSelectStyle = window.selectStyle;
    window.selectStyle = function(styleId){
      originalSelectStyle(styleId);
      renderPage2();
      renderPage3();
    };

    const _renderPage2 = renderPage2;
    renderPage2 = function(){
      _renderPage2();
      const s = getSelectedStyle();
      if(!s) return;
      const isCarry = s.developmentType === 'CARRY OVER';
      document.getElementById('refSeason').disabled = !isCarry;
      document.getElementById('btnLoadReference').disabled = !isCarry;
      if(!isCarry) document.getElementById('refSeason').value = '';
    };
  }

  // Start on login screen
  showLogin();
</script>

</body>
</html>
